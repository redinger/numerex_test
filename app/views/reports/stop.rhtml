<%= render :partial => 'report_header' %>

<table class="text_width">
	<tr>
		<td width="50%" valign="top" id="left_panel">
			<table class="panel_table">
				<tr>
					<th>Location</th>
					<th>Stop Duration (s)</th>
					<th>When</th>
				</tr>                
                <%if  !@stops.empty?%> 
				<% for reading in @stops %>
					<tr class="<%= cycle('dark_row', 'light_row') %>" id="row<%= reading.id %>">
						<td><a href="javascript:centerMapOnReading(<%= reading.id %>);highlightRow(<%= reading.id %>)" ><%= reading.shortAddress %></a></td>
						<% length=nil%>
						<% if(!reading.duration.nil? && reading.duration>0) then length=time_ago_in_words Time.now+reading.duration end%>
						<% if(!reading.duration.nil? && reading.duration<0) then length="in progress: " + (time_ago_in_words reading.created_at+@stop_threshold) + " so far" end%>
						<td><%= length || "unknown" %></td>
						<% length=nil%>
						<td><script>document.write(displayLocalDT(<%= reading.created_at.to_i*1000 %>));</script></td>
					</tr>
					<script>readings.push({id: <%= reading.id %>, lat: <%= reading.latitude %>, lng: <%= reading.longitude%>, address: '<%= escape_javascript reading.shortAddress %>', dt: displayLocalDT(<%= reading.created_at.to_i*1000 %>), note: '<%= reading.note %>', event: '<%= reading.event_type %>'});</script>
				<% end %>
                 <%else%>
                     <%flag=true%>
                 <%end%>            
			</table>
                <%if flag%>
                       <div class="alert">
                            <span>No geofence events found.</span>
                       </div>                                       
                <%end%>                        
		</td>
		<td><a href="javascript:toggleMap();" title="Expand map view" id="toggler_link"><img src="/images/collapse.png" border="0" id="toggler" /></a></td>
		<td width="50%" valign="top" id="right_panel">
			<div id="map" class="reports_map"></div>
		</td>
	</tr>
</table>

<%= render :partial => 'report_footer' %>
